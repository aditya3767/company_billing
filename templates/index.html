<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzeria Billing System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        form { display: flex; flex-direction: column; gap: 10px; }
        input, select, button { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #4CAF50; color: white; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #output { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 4px; }
        .hidden { display: none; }
        .product-row { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pizzeria Billing System</h1>

        <!-- Auth Section -->
        <div id="auth-section">
            <h2>Login</h2>
            <form id="auth-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
                <button type="button" onclick="showRegister()">Register</button>
            </form>
        </div>

        <!-- Register Section -->
        <div id="register-section" class="hidden">
            <h2>Register</h2>
            <form id="register-form">
                <input type="text" id="first-name" placeholder="First Name" required>
                <input type="text" id="last-name" placeholder="Last Name" required>
                <select id="gender" required><option value="">Gender</option><option value="Male">Male</option><option value="Female">Female</option><option value="Other">Other</option></select>
                <input type="number" id="age" placeholder="Age" min="0" max="80" required>
                <input type="tel" id="phone" placeholder="Phone" required>
                <input type="email" id="reg-email" placeholder="Email" required>
                <input type="password" id="reg-password" placeholder="Password" required>
                <input type="password" id="confirm-password" placeholder="Confirm Password" required>
                <button type="submit">Register & Send OTP</button>
            </form>
            <div id="otp-section" class="hidden">
                <h3>Enter OTP</h3>
                <input type="text" id="otp" placeholder="6-digit OTP" maxlength="6">
                <button onclick="verifyOtp()">Verify</button>
            </div>
        </div>

        <!-- OTP Section (after register) -->
        <div id="otp-section-global" class="hidden">...</div>  <!-- Reuse above -->

        <!-- Billing Section -->
        <div id="billing-section" class="hidden">
            <h2>Billing</h2>
            <div class="section">
                <h3>Customer</h3>
                <input type="text" id="company" placeholder="Company">
                <input type="text" id="gst" placeholder="GST">
                <input type="text" id="vehicle" placeholder="Vehicle No.">
                <input type="text" id="supply-place" placeholder="Place of Supply">
                <input type="text" id="invoice-no" placeholder="Invoice No." required>
            </div>
            <div class="section">
                <h3>Products</h3>
                <div class="product-row"><label>Package Water (₹29): <input type="number" id="water-qty" min="0" value="0"></label></div>
                <div class="product-row"><label>Bisleri 250ml (₹240): <input type="number" id="bisleri-250" min="0" value="0"></label></div>
                <div class="product-row"><label>Bisleri 500ml (₹340): <input type="number" id="bisleri-500" min="0" value="0"></label></div>
                <div class="product-row"><label>Bisleri 1L (₹240): <input type="number" id="bisleri-1l" min="0" value="0"></label></div>
                <div class="product-row"><label>Bisleri 2L (₹270): <input type="number" id="bisleri-2l" min="0" value="0"></label></div>
                <div class="product-row"><label>Bisleri 5L (₹75): <input type="number" id="bisleri-5l" min="0" value="0"></label></div>
                <div class="product-row"><label>Pepsi (₹45): <input type="number" id="pepsi-qty" min="0" value="0"></label></div>
                <div class="product-row"><label>Sprite (₹35): <input type="number" id="sprite-qty" min="0" value="0"></label></div>
                <div class="product-row"><label>Mirinda (₹15): <input type="number" id="mirinda-qty" min="0" value="0"></label></div>
                <div class="product-row"><label>Sting (₹15): <input type="number" id="sting-qty" min="0" value="0"></label></div>
                <div class="product-row"><label>Thums Up (₹45): <input type="number" id="thums-up-qty" min="0" value="0"></label></div>
                <div class="product-row"><label>Coca Cola (₹45): <input type="number" id="coca-qty" min="0" value="0"></label></div>
            </div>
            <button onclick="generateBill()">Generate Bill</button>
            <button onclick="generateReport()">Report</button>
            <button onclick="logout()">Logout</button>
        </div>
        <div id="output"></div>
    </div>

    <script>
        const API_BASE = '/';  // Local dev; update to 'https://your-app.onrender.com/' after deploy

        // ... (keep existing functions for showRegister, showLogin, logout, generateReport)

        // Register submit
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = { /* collect fields as before */ };
            const res = await fetch(`${API_BASE}register`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(formData) });
            const data = await res.json();
            if (data.success) {
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('otp-section').classList.remove('hidden');  // Show OTP input
            } else alert(data.message);
        });

        // Verify OTP
        async function verifyOtp() {
            const email = document.getElementById('reg-email').value;
            const otp = document.getElementById('otp').value;
            const res = await fetch(`${API_BASE}verify-otp`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({email, otp}) });
            const data = await res.json();
            if (data.success) {
                alert('Verified! You can now login.');
                showLogin();
            } else alert(data.message);
        }

        // Generate Bill (updated to collect all products)
        async function generateBill() {
            const products = [
                {name: 'Package Water', qty: document.getElementById('water-qty').value, rate: 29},
                {name: 'Bisleri 250ml', qty: document.getElementById('bisleri-250').value, rate: 240},
                // ... add all from form
                {name: 'Coca Cola', qty: document.getElementById('coca-qty').value, rate: 45}
            ];
            const formData = {
                invoice_no: document.getElementById('invoice-no').value,
                company: document.getElementById('company').value,
                gst: document.getElementById('gst').value,
                vehicle: document.getElementById('vehicle').value,
                supply_place: document.getElementById('supply-place').value,
                products
            };
            const res = await fetch(`${API_BASE}generate-bill`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(formData) });
            const data = await res.json();
            if (data.success) {
                document.getElementById('output').innerHTML = `<p>Total: ₹${data.total}</p><a href="${API_BASE}download-pdf/${formData.invoice_no}" download>Download PDF</a>`;
            } else alert(data.message);
        }

        // Login (updated to show billing)
        // ... (keep as before)
    </script>
</body>
</html>